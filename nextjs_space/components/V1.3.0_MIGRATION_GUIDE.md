# v1.3.0 Frontend Migration Guide

## âœ… What's New

### Onboarding v1.3.0 (8 components)
- `OnboardingV130.tsx` - Main orchestrator with progress bar
- `Step1BasicData.tsx` - Idade, gÃªnero, peso, altura, IMC, FC, sono, estresse
- `Step2SportBackground.tsx` - ExperiÃªncia corrida + outros esportes
- `Step3Performance.tsx` - Melhores tempos + VDOT real-time
- `Step4Health.tsx` - HistÃ³rico lesÃµes + liberaÃ§Ã£o mÃ©dica
- `Step5Goals.tsx` - Objetivo principal + motivaÃ§Ã£o
- `Step6Availability.tsx` - Dias corrida + outras atividades
- `Step7Review.tsx` - RevisÃ£o final antes de gerar

**Total:** ~800 LOC

### Profile v1.3.0 (7 components)
- `ProfileTabs.tsx` - Main tabs container
- `BasicDataTab.tsx` - Editar dados bÃ¡sicos (idade, peso, IMC, etc)
- `PerformanceTab.tsx` - Gerenciar melhores tempos
- `HealthTab.tsx` - Atualizar histÃ³rico de lesÃµes
- `GoalsTab.tsx` - Modificar objetivos
- `AvailabilityTab.tsx` - **AUTO-AJUSTE DE PLANO** ao mudar dias
- `PreferencesTab.tsx` - PreferÃªncias de treino

**Total:** ~515 LOC

## ðŸ”§ How to Integrate

### 1. Update Onboarding Page

```typescript
// app/onboarding/page.tsx
import { OnboardingV130 } from '@/components/onboarding/v1.3.0';

export default function OnboardingPage() {
  const handleComplete = async (data: any) => {
    const response = await fetch('/api/profile/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    if (response.ok) {
      router.push('/dashboard');
    }
  };

  return <OnboardingV130 onComplete={handleComplete} />;
}
```

### 2. Update Profile Page

```typescript
// app/perfil/page.tsx
import { ProfileTabs } from '@/components/profile/v1.3.0';

export default function ProfilePage() {
  const { data: session } = useSession();
  const [userData, setUserData] = useState(null);

  const handleUpdate = async (updates: any) => {
    const response = await fetch('/api/profile/update', {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updates)
    });
    
    if (response.ok) {
      const updated = await response.json();
      setUserData(updated);
      
      // Se mudou disponibilidade, re-gerar plano
      if (updates.availableDays) {
        await fetch('/api/plan/auto-adjust', { method: 'POST' });
      }
    }
  };

  return (
    <ProfileTabs 
      userData={userData} 
      onUpdate={handleUpdate} 
    />
  );
}
```

### 3. Auto-Adjust on Profile Changes

Quando `AvailabilityTab` salvar mudanÃ§as:

```typescript
// In ProfileTabs.tsx -> handleUpdate()
if (updates.availableDays) {
  // Trigger auto-adjust (free feature)
  await fetch('/api/plan/auto-adjust', {
    method: 'POST',
    body: JSON.stringify({ 
      reason: 'availability_change',
      preserveHistory: true // Keep past workouts
    })
  });
  
  toast.success('Plano atualizado com nova disponibilidade!');
}
```

## ðŸ“‹ Migration Checklist

- [ ] Install components: `onboarding/v1.3.0` and `profile/v1.3.0`
- [ ] Update `/api/profile/create` to accept all 13 new fields
- [ ] Update `/api/profile/update` for incremental updates
- [ ] Create `/api/plan/auto-adjust` endpoint
- [ ] Update onboarding page to use `OnboardingV130`
- [ ] Update profile page to use `ProfileTabs`
- [ ] Test onboarding flow end-to-end
- [ ] Test profile editing + auto-adjust
- [ ] Deploy to production

## ðŸŽ¯ Key Features

âœ… **7-step onboarding** with validation  
âœ… **IMC real-time** calculation  
âœ… **VDOT real-time** from best times  
âœ… **Injury prevention** via history  
âœ… **Auto-adjust plan** on availability change (FREE)  
âœ… **6 profile tabs** - all editable  
âœ… **Progress bar** visual feedback  
âœ… **Mobile responsive**

## ðŸš€ Next Steps After Deployment

1. Monitor user completion rates (7 steps vs old 5)
2. A/B test onboarding completion time
3. Track auto-adjust usage after profile changes
4. Collect feedback on new fields

---

**Created:** 03/Nov/2025 21:15  
**Total LOC:** 1315 lines  
**Status:** âœ… Ready for integration
